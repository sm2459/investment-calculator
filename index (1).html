<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Investment Allocation Calculator</title>
    
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-XXXXXXXXXX');
    </script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // Lucide React icons as inline SVGs
        const DollarSign = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="12" y1="1" x2="12" y2="23"></line>
                <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path>
            </svg>
        );

        const TrendingUp = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                <polyline points="17 6 23 6 23 12"></polyline>
            </svg>
        );

        const Percent = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="19" y1="5" x2="5" y2="19"></line>
                <circle cx="6.5" cy="6.5" r="2.5"></circle>
                <circle cx="17.5" cy="17.5" r="2.5"></circle>
            </svg>
        );

        const Info = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="16" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12.01" y2="8"></line>
            </svg>
        );

        const Sliders = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <line x1="4" y1="21" x2="4" y2="14"></line>
                <line x1="4" y1="10" x2="4" y2="3"></line>
                <line x1="12" y1="21" x2="12" y2="12"></line>
                <line x1="12" y1="8" x2="12" y2="3"></line>
                <line x1="20" y1="21" x2="20" y2="16"></line>
                <line x1="20" y1="12" x2="20" y2="3"></line>
                <line x1="1" y1="14" x2="7" y2="14"></line>
                <line x1="9" y1="8" x2="15" y2="8"></line>
                <line x1="17" y1="16" x2="23" y2="16"></line>
            </svg>
        );

        const Sparkles = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"></path>
                <path d="M5 3v4"></path>
                <path d="M19 17v4"></path>
                <path d="M3 5h4"></path>
                <path d="M17 19h4"></path>
            </svg>
        );

        const Mail = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <rect x="2" y="4" width="20" height="16" rx="2"></rect>
                <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"></path>
            </svg>
        );

        const Download = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        function InvestmentCalculator() {
            const [mode, setMode] = useState('guided'); // 'guided' or 'custom'
            const [investmentAmount, setInvestmentAmount] = useState(10000);
            const [expectedReturn, setExpectedReturn] = useState(8); // Annual return %
            const [timeHorizon, setTimeHorizon] = useState(10); // Years
            const [usAllocation, setUsAllocation] = useState(70);
            const [recurringContribution, setRecurringContribution] = useState(0);
            const [contributionFrequency, setContributionFrequency] = useState('monthly'); // 'daily', 'weekly', 'monthly', 'quarterly', 'annually'
            const [userEmail, setUserEmail] = useState('');
            const [isGeneratingPDF, setIsGeneratingPDF] = useState(false);
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            const growthChartRef = useRef(null);
            const growthChartInstance = useRef(null);
            
            const internationalAllocation = 100 - usAllocation;

            // Memoize chart dependencies to prevent unnecessary re-renders
            const chartDeps = useMemo(() => ({
                investmentAmount,
                usAllocation,
                mode,
                customFunds
            }), [investmentAmount, usAllocation, mode, JSON.stringify(customFunds)]);
            
            const growthChartDeps = useMemo(() => ({
                expectedReturn,
                timeHorizon,
                recurringContribution,
                contributionFrequency,
                investmentAmount
            }), [expectedReturn, timeHorizon, recurringContribution, contributionFrequency, investmentAmount]);

            // ETF options with real data - expanded with multiple providers
            const etfs = {
                // Vanguard ETFs
                voo: { 
                    name: 'VOO', 
                    fullName: 'Vanguard S&P 500 ETF', 
                    expenseRatio: 0.03, 
                    type: 'US Large Cap',
                    provider: 'Vanguard',
                    dividendYield: 1.5,
                    taxEfficiency: 'Excellent',
                    turnover: 3
                },
                vti: { 
                    name: 'VTI', 
                    fullName: 'Vanguard Total Stock Market ETF', 
                    expenseRatio: 0.03, 
                    type: 'US Total Market',
                    provider: 'Vanguard',
                    dividendYield: 1.5,
                    taxEfficiency: 'Excellent',
                    turnover: 4
                },
                vxus: { 
                    name: 'VXUS', 
                    fullName: 'Vanguard Total International Stock ETF', 
                    expenseRatio: 0.08, 
                    type: 'International',
                    provider: 'Vanguard',
                    dividendYield: 3.2,
                    taxEfficiency: 'Very Good',
                    turnover: 5
                },
                vb: { 
                    name: 'VB', 
                    fullName: 'Vanguard Small-Cap ETF', 
                    expenseRatio: 0.05, 
                    type: 'US Small Cap',
                    provider: 'Vanguard',
                    dividendYield: 1.3,
                    taxEfficiency: 'Very Good',
                    turnover: 15
                },
                vwo: { 
                    name: 'VWO', 
                    fullName: 'Vanguard Emerging Markets ETF', 
                    expenseRatio: 0.08, 
                    type: 'Emerging Markets',
                    provider: 'Vanguard',
                    dividendYield: 3.5,
                    taxEfficiency: 'Good',
                    turnover: 8
                },
                vea: { 
                    name: 'VEA', 
                    fullName: 'Vanguard Developed Markets ETF', 
                    expenseRatio: 0.05, 
                    type: 'Developed International',
                    provider: 'Vanguard',
                    dividendYield: 3.0,
                    taxEfficiency: 'Very Good',
                    turnover: 4
                },
                
                // Schwab ETFs
                schb: { 
                    name: 'SCHB', 
                    fullName: 'Schwab U.S. Broad Market ETF', 
                    expenseRatio: 0.03, 
                    type: 'US Total Market',
                    provider: 'Schwab',
                    dividendYield: 1.4,
                    taxEfficiency: 'Excellent',
                    turnover: 4
                },
                schx: { 
                    name: 'SCHX', 
                    fullName: 'Schwab U.S. Large-Cap ETF', 
                    expenseRatio: 0.03, 
                    type: 'US Large Cap',
                    provider: 'Schwab',
                    dividendYield: 1.5,
                    taxEfficiency: 'Excellent',
                    turnover: 3
                },
                schf: { 
                    name: 'SCHF', 
                    fullName: 'Schwab International Equity ETF', 
                    expenseRatio: 0.06, 
                    type: 'International',
                    provider: 'Schwab',
                    dividendYield: 3.1,
                    taxEfficiency: 'Very Good',
                    turnover: 5
                },
                scha: { 
                    name: 'SCHA', 
                    fullName: 'Schwab U.S. Small-Cap ETF', 
                    expenseRatio: 0.04, 
                    type: 'US Small Cap',
                    provider: 'Schwab',
                    dividendYield: 1.2,
                    taxEfficiency: 'Very Good',
                    turnover: 12
                },
                sche: { 
                    name: 'SCHE', 
                    fullName: 'Schwab Emerging Markets Equity ETF', 
                    expenseRatio: 0.11, 
                    type: 'Emerging Markets',
                    provider: 'Schwab',
                    dividendYield: 3.4,
                    taxEfficiency: 'Good',
                    turnover: 9
                },
                
                // iShares Core ETFs (BlackRock)
                itot: { 
                    name: 'ITOT', 
                    fullName: 'iShares Core S&P Total U.S. Stock Market ETF', 
                    expenseRatio: 0.03, 
                    type: 'US Total Market',
                    provider: 'iShares',
                    dividendYield: 1.4,
                    taxEfficiency: 'Excellent',
                    turnover: 3
                },
                ivv: { 
                    name: 'IVV', 
                    fullName: 'iShares Core S&P 500 ETF', 
                    expenseRatio: 0.03, 
                    type: 'US Large Cap',
                    provider: 'iShares',
                    dividendYield: 1.5,
                    taxEfficiency: 'Excellent',
                    turnover: 3
                },
                ixus: { 
                    name: 'IXUS', 
                    fullName: 'iShares Core MSCI Total International Stock ETF', 
                    expenseRatio: 0.07, 
                    type: 'International',
                    provider: 'iShares',
                    dividendYield: 3.3,
                    taxEfficiency: 'Very Good',
                    turnover: 5
                },
                ijr: { 
                    name: 'IJR', 
                    fullName: 'iShares Core S&P Small-Cap ETF', 
                    expenseRatio: 0.06, 
                    type: 'US Small Cap',
                    provider: 'iShares',
                    dividendYield: 1.3,
                    taxEfficiency: 'Very Good',
                    turnover: 14
                },
                iemg: { 
                    name: 'IEMG', 
                    fullName: 'iShares Core MSCI Emerging Markets ETF', 
                    expenseRatio: 0.09, 
                    type: 'Emerging Markets',
                    provider: 'iShares',
                    dividendYield: 3.6,
                    taxEfficiency: 'Good',
                    turnover: 10
                },
                
                // SPDR (State Street)
                spy: { 
                    name: 'SPY', 
                    fullName: 'SPDR S&P 500 ETF Trust', 
                    expenseRatio: 0.09, 
                    type: 'US Large Cap',
                    provider: 'SPDR',
                    dividendYield: 1.5,
                    taxEfficiency: 'Excellent',
                    turnover: 3
                },
                sptm: { 
                    name: 'SPTM', 
                    fullName: 'SPDR Portfolio S&P 1500 Composite Stock Market ETF', 
                    expenseRatio: 0.03, 
                    type: 'US Total Market',
                    provider: 'SPDR',
                    dividendYield: 1.4,
                    taxEfficiency: 'Excellent',
                    turnover: 4
                },
                spem: { 
                    name: 'SPEM', 
                    fullName: 'SPDR Portfolio Emerging Markets ETF', 
                    expenseRatio: 0.07, 
                    type: 'Emerging Markets',
                    provider: 'SPDR',
                    dividendYield: 3.7,
                    taxEfficiency: 'Good',
                    turnover: 11
                }
            };

            // Guided portfolio options
            const guidedPortfolios = [
                { 
                    name: 'Simple Two-Fund', 
                    funds: [
                        { ticker: 'VTI', allocation: 'us' },
                        { ticker: 'VXUS', allocation: 'international' }
                    ],
                    description: 'Classic & clean - total market coverage',
                    complexity: 'Simplest'
                },
                { 
                    name: 'S&P 500 Focus', 
                    funds: [
                        { ticker: 'VOO', allocation: 'us' },
                        { ticker: 'VXUS', allocation: 'international' }
                    ],
                    description: 'Large-cap US companies',
                    complexity: 'Simplest'
                },
                { 
                    name: 'Small-Cap Tilt', 
                    funds: [
                        { ticker: 'VOO', allocation: 'us', weight: 0.8 },
                        { ticker: 'VB', allocation: 'us', weight: 0.2 },
                        { ticker: 'VXUS', allocation: 'international' }
                    ],
                    description: '80/20 large/small cap US split',
                    complexity: '3 funds'
                },
                { 
                    name: 'Emerging Markets Split', 
                    funds: [
                        { ticker: 'VTI', allocation: 'us' },
                        { ticker: 'VEA', allocation: 'international', weight: 0.6 },
                        { ticker: 'VWO', allocation: 'international', weight: 0.4 }
                    ],
                    description: 'Separate developed & emerging intl',
                    complexity: '3 funds'
                }
            ];

            const [selectedPortfolio, setSelectedPortfolio] = useState(0);
            
            // Custom mode state
            const [customFunds, setCustomFunds] = useState([
                { ticker: 'VTI', allocation: 70 },
                { ticker: 'VXUS', allocation: 30 }
            ]);

            // Calculate allocations based on mode
            const getCurrentFunds = () => {
                if (mode === 'guided') {
                    const portfolio = guidedPortfolios[selectedPortfolio];
                    const usAmount = (investmentAmount * usAllocation) / 100;
                    const intAmount = (investmentAmount * internationalAllocation) / 100;
                    
                    return portfolio.funds.map(fund => {
                        const etf = etfs[fund.ticker.toLowerCase()];
                        const baseAmount = fund.allocation === 'us' ? usAmount : intAmount;
                        const weight = fund.weight || 1;
                        const amount = baseAmount * weight;
                        const cost = amount * (etf.expenseRatio / 100);
                        
                        return {
                            ...etf,
                            ticker: fund.ticker,
                            amount,
                            cost,
                            percentage: (amount / investmentAmount) * 100
                        };
                    });
                } else {
                    // Custom mode
                    return customFunds.map(fund => {
                        const etf = etfs[fund.ticker.toLowerCase()];
                        const amount = (investmentAmount * fund.allocation) / 100;
                        const cost = amount * (etf.expenseRatio / 100);
                        
                        return {
                            ...etf,
                            ticker: fund.ticker,
                            amount,
                            cost,
                            percentage: fund.allocation
                        };
                    });
                }
            };

            const fundAllocations = getCurrentFunds();

            // Calculate totals
            const totalCost = fundAllocations.reduce((sum, fund) => sum + fund.cost, 0);
            const weightedExpenseRatio = investmentAmount > 0 
                ? fundAllocations.reduce((sum, fund) => sum + (fund.amount * fund.expenseRatio), 0) / investmentAmount
                : fundAllocations.reduce((sum, fund) => sum + fund.expenseRatio, 0) / fundAllocations.length;

            // Calculate growth projections with DCA
            const calculateGrowth = () => {
                const years = [];
                const values = [];
                const costImpact = [];
                const totalContributions = [];
                const dividendIncome = [];
                
                // Calculate weighted average dividend yield
                const weightedDividendYield = fundAllocations.reduce((sum, fund) => 
                    sum + ((fund.amount / investmentAmount) * fund.dividendYield), 0) || 
                    fundAllocations.reduce((sum, fund) => sum + fund.dividendYield, 0) / fundAllocations.length;
                
                // Convert contribution frequency to number of periods per year
                const periodsPerYear = contributionFrequency === 'daily' ? 252 :      // Business days (Mon-Fri)
                                     contributionFrequency === 'weekly' ? 52 : 
                                     contributionFrequency === 'monthly' ? 12 : 
                                     contributionFrequency === 'quarterly' ? 4 : 1;
                const contributionPerPeriod = recurringContribution;
                
                for (let year = 0; year <= timeHorizon; year++) {
                    years.push(year);
                    
                    let portfolioValue = investmentAmount;
                    let portfolioValueNoFees = investmentAmount;
                    let totalInvested = investmentAmount;
                    let yearlyDividends = 0;
                    
                    const netReturn = (expectedReturn - weightedExpenseRatio) / 100;
                    const grossReturn = expectedReturn / 100;
                    
                    // Calculate compound interest with regular contributions
                    for (let period = 1; period <= year * periodsPerYear; period++) {
                        // Add contribution at the beginning of each period
                        portfolioValue += contributionPerPeriod;
                        portfolioValueNoFees += contributionPerPeriod;
                        totalInvested += contributionPerPeriod;
                        
                        // Apply return for the period (annual rate / periods per year)
                        portfolioValue *= (1 + netReturn / periodsPerYear);
                        portfolioValueNoFees *= (1 + grossReturn / periodsPerYear);
                    }
                    
                    // Calculate dividends for the year (estimate based on average portfolio value)
                    if (year > 0) {
                        const avgPortfolioValue = (values[year - 1] + portfolioValue) / 2;
                        yearlyDividends = avgPortfolioValue * (weightedDividendYield / 100);
                    }
                    
                    // If year 0, just use initial investment
                    if (year === 0) {
                        portfolioValue = investmentAmount;
                        portfolioValueNoFees = investmentAmount;
                        totalInvested = investmentAmount;
                        yearlyDividends = investmentAmount * (weightedDividendYield / 100);
                    }
                    
                    values.push(portfolioValue);
                    costImpact.push(portfolioValueNoFees - portfolioValue);
                    totalContributions.push(totalInvested);
                    dividendIncome.push(yearlyDividends);
                }
                
                return { years, values, costImpact, totalContributions, dividendIncome, weightedDividendYield };
            };

            const growthData = calculateGrowth();
            const finalValue = growthData.values[growthData.values.length - 1];
            const totalContributed = growthData.totalContributions[growthData.totalContributions.length - 1];
            const totalReturn = finalValue - totalContributed;
            const totalFeesLost = growthData.costImpact[growthData.costImpact.length - 1];
            const totalDividends = growthData.dividendIncome.reduce((sum, val) => sum + val, 0);
            const capitalGains = totalReturn - totalDividends;

            // Find lowest fee portfolio for comparison
            const getLowestFeePortfolio = () => {
                let lowestFee = Infinity;
                let lowestIndex = 0;
                
                guidedPortfolios.forEach((portfolio, index) => {
                    const usAmount = (investmentAmount * usAllocation) / 100;
                    const intAmount = (investmentAmount * internationalAllocation) / 100;
                    
                    const fee = portfolio.funds.reduce((sum, fund) => {
                        const etf = etfs[fund.ticker.toLowerCase()];
                        const baseAmount = fund.allocation === 'us' ? usAmount : intAmount;
                        const weight = fund.weight || 1;
                        const amount = baseAmount * weight;
                        return sum + (amount * etf.expenseRatio);
                    }, 0) / investmentAmount;
                    
                    if (fee < lowestFee) {
                        lowestFee = fee;
                        lowestIndex = index;
                    }
                });
                
                return { lowestFee, lowestIndex };
            };

            const { lowestFee, lowestIndex } = mode === 'guided' ? getLowestFeePortfolio() : { lowestFee: null, lowestIndex: null };

            // Data for pie chart
            const colors = ['#3b82f6', '#6366f1', '#10b981', '#059669', '#f59e0b', '#ef4444'];

            // Create/update allocation chart
            useEffect(() => {
                if (chartRef.current) {
                    const ctx = chartRef.current.getContext('2d');
                    
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }

                    // Only create chart if there's money to show
                    if (investmentAmount > 0) {
                        chartInstance.current = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: fundAllocations.map(fund => fund.ticker),
                                datasets: [{
                                    data: fundAllocations.map(fund => fund.amount),
                                    backgroundColor: colors.slice(0, fundAllocations.length),
                                    borderWidth: 2,
                                    borderColor: '#ffffff'
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: true,
                                plugins: {
                                    legend: {
                                        position: 'bottom',
                                        labels: {
                                            padding: 15,
                                            font: { size: 12 }
                                        }
                                    },
                                    tooltip: {
                                        callbacks: {
                                            label: function(context) {
                                                const label = context.label || '';
                                                const value = context.parsed || 0;
                                                return label + ': $' + value.toLocaleString('en-US', { 
                                                    minimumFractionDigits: 2, 
                                                    maximumFractionDigits: 2 
                                                });
                                            }
                                        }
                                    }
                                }
                            }
                        });
                    }
                }

                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [fundAllocations, investmentAmount]);

            // Create/update growth chart
            useEffect(() => {
                if (growthChartRef.current) {
                    const ctx = growthChartRef.current.getContext('2d');
                    
                    if (growthChartInstance.current) {
                        growthChartInstance.current.destroy();
                    }

                    growthChartInstance.current = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: growthData.years,
                            datasets: [
                                {
                                    label: 'Portfolio Value',
                                    data: growthData.values,
                                    borderColor: '#3b82f6',
                                    backgroundColor: 'rgba(59, 130, 246, 0.1)',
                                    fill: true,
                                    tension: 0.4
                                },
                                {
                                    label: 'Total Contributions',
                                    data: growthData.totalContributions,
                                    borderColor: '#10b981',
                                    backgroundColor: 'rgba(16, 185, 129, 0.1)',
                                    fill: false,
                                    tension: 0.4,
                                    borderDash: [5, 5]
                                }
                            ]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: true,
                            plugins: {
                                legend: {
                                    display: true,
                                    position: 'top'
                                },
                                tooltip: {
                                    callbacks: {
                                        label: function(context) {
                                            return context.dataset.label + ': $' + context.parsed.y.toLocaleString('en-US', { 
                                                minimumFractionDigits: 0, 
                                                maximumFractionDigits: 0 
                                            });
                                        }
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: false,
                                    ticks: {
                                        callback: function(value) {
                                            return '$' + (value / 1000).toFixed(0) + 'k';
                                        }
                                    }
                                },
                                x: {
                                    title: {
                                        display: true,
                                        text: 'Years'
                                    }
                                }
                            }
                        }
                    });
                }

                return () => {
                    if (growthChartInstance.current) {
                        growthChartInstance.current.destroy();
                    }
                };
            }, [growthData, expectedReturn, timeHorizon, recurringContribution, contributionFrequency, fundAllocations]);

            const addCustomFund = () => {
                const availableFunds = Object.keys(etfs).filter(
                    key => !customFunds.some(f => f.ticker.toLowerCase() === key)
                );
                if (availableFunds.length > 0) {
                    setCustomFunds([...customFunds, { 
                        ticker: availableFunds[0].toUpperCase(), 
                        allocation: 0 
                    }]);
                }
            };

            const removeCustomFund = (index) => {
                if (customFunds.length > 1) {
                    setCustomFunds(customFunds.filter((_, i) => i !== index));
                }
            };

            const updateCustomFund = (index, field, value) => {
                const updated = [...customFunds];
                updated[index][field] = value;
                setCustomFunds(updated);
            };

            const normalizeAllocations = () => {
                const numFunds = customFunds.length;
                const baseAllocation = Math.floor(100 / numFunds);
                const remainder = 100 - (baseAllocation * numFunds);
                
                // Distribute evenly, giving remainder to first fund(s)
                const normalized = customFunds.map((fund, index) => ({
                    ...fund,
                    allocation: baseAllocation + (index < remainder ? 1 : 0)
                }));
                
                setCustomFunds(normalized);
            };

            const generatePDF = async () => {
                setIsGeneratingPDF(true);
                
                try {
                    const { jsPDF } = window.jspdf;
                    const pdf = new jsPDF('p', 'mm', 'a4');
                    const W = 210; // page width
                    const H = 297; // page height
                    const M = 12; // margin
                    let Y = 0;
                    
                    // Compact box helper
                    const box = (x, y, w, h, fill, border) => {
                        pdf.setFillColor(fill[0], fill[1], fill[2]);
                        pdf.setDrawColor(border[0], border[1], border[2]);
                        pdf.setLineWidth(0.3);
                        pdf.roundedRect(x, y, w, h, 1.5, 1.5, 'FD');
                    };
                    
                    // === PAGE 1: Header ===
                    pdf.setFillColor(59, 130, 246);
                    pdf.rect(0, 0, W, 35, 'F');
                    pdf.setFontSize(20);
                    pdf.setTextColor(255, 255, 255);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('Investment Allocation Report', W / 2, 20, { align: 'center' });
                    pdf.setFontSize(9);
                    pdf.setFont('helvetica', 'normal');
                    pdf.text('Generated: ' + new Date().toLocaleDateString(), W / 2, 28, { align: 'center' });
                    
                    Y = 43;
                    
                    // === Summary ===
                    pdf.setTextColor(0, 0, 0);
                    pdf.setFontSize(12);
                    pdf.setFont('helvetica', 'bold');
                    pdf.text('PORTFOLIO SUMMARY', M, Y);
                    Y += 5;
                    
                    box(M, Y, W - 2 * M, 24, [239, 246, 255], [191, 219, 254]);
                    pdf.setFontSize(8.5);
                    pdf.setFont('helvetica', 'normal');
                    pdf.setTextColor(30, 30, 30);
                    Y += 5;
                    pdf.text('Mode: ' + (mode === 'guided' ? 'Guided Portfolio' : 'Custom Mix'), M + 3, Y);
                    Y += 4.5;
                    pdf.text('Initial: $' + investmentAmount.toLocaleString() + (recurringContribution > 0 ? '  |  Recurring: $' + recurringContribution.toLocaleString() + ' (' + contributionFrequency + ')' : ''), M + 3, Y);
                    Y += 4.5;
                    pdf.text('Time: ' + timeHorizon + ' years  |  Expected Return: ' + expectedReturn + '%', M + 3, Y);
                    Y += 11;
                    
                    // === Funds ===
                    pdf.setFontSize(12);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(0, 0, 0);
                    pdf.text('FUND ALLOCATIONS', M, Y);
                    Y += 5;
                    
                    const cols = [
                        { fill: [239, 246, 255], border: [191, 219, 254], text: [59, 130, 246] },
                        { fill: [243, 244, 246], border: [209, 213, 219], text: [99, 102, 241] },
                        { fill: [236, 253, 245], border: [167, 243, 208], text: [16, 185, 129] }
                    ];
                    
                    fundAllocations.forEach((f, i) => {
                        const c = cols[i % cols.length];
                        box(M, Y, W - 2 * M, 19, c.fill, c.border);
                        
                        pdf.setFontSize(9.5);
                        pdf.setFont('helvetica', 'bold');
                        pdf.setTextColor(c.text[0], c.text[1], c.text[2]);
                        pdf.text(f.ticker, M + 3, Y + 5);
                        
                        pdf.setFont('helvetica', 'normal');
                        pdf.setTextColor(60, 60, 60);
                        pdf.setFontSize(7.5);
                        pdf.text(f.fullName, M + 18, Y + 5);
                        
                        pdf.setFillColor(255, 255, 255);
                        pdf.roundedRect(W - M - 18, Y + 2.5, 15, 3.5, 0.8, 0.8, 'F');
                        pdf.setFontSize(6.5);
                        pdf.setTextColor(80, 80, 80);
                        pdf.text(f.provider, W - M - 10.5, Y + 5, { align: 'center' });
                        
                        pdf.setFontSize(10);
                        pdf.setFont('helvetica', 'bold');
                        pdf.setTextColor(0, 0, 0);
                        pdf.text('$' + f.amount.toLocaleString('en-US', { maximumFractionDigits: 0 }), M + 3, Y + 11);
                        
                        pdf.setFontSize(8.5);
                        pdf.setFont('helvetica', 'normal');
                        pdf.setTextColor(100, 100, 100);
                        pdf.text('(' + f.percentage.toFixed(1) + '%)', M + 38, Y + 11);
                        
                        pdf.setFontSize(6.5);
                        pdf.setTextColor(80, 80, 80);
                        pdf.text('Fee: ' + f.expenseRatio + '%  |  Yield: ' + f.dividendYield + '%  |  Tax: ' + f.taxEfficiency, M + 3, Y + 15.5);
                        
                        Y += 20.5;
                    });
                    
                    // === Cost Analysis (3 boxes) ===
                    pdf.setFontSize(12);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(0, 0, 0);
                    pdf.text('COST ANALYSIS', M, Y);
                    Y += 5;
                    
                    const bw = (W - 2 * M - 6) / 3;
                    
                    box(M, Y, bw, 16, [239, 246, 255], [147, 197, 253]);
                    pdf.setFontSize(6.5);
                    pdf.setTextColor(100, 100, 100);
                    pdf.text('Weighted Expense', M + bw / 2, Y + 4.5, { align: 'center' });
                    pdf.setFontSize(13);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(59, 130, 246);
                    pdf.text(weightedExpenseRatio.toFixed(3) + '%', M + bw / 2, Y + 12, { align: 'center' });
                    
                    box(M + bw + 3, Y, bw, 16, [254, 249, 195], [253, 224, 71]);
                    pdf.setFontSize(6.5);
                    pdf.setFont('helvetica', 'normal');
                    pdf.setTextColor(100, 100, 100);
                    pdf.text('Annual Cost', M + bw + 3 + bw / 2, Y + 4.5, { align: 'center' });
                    pdf.setFontSize(13);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(245, 158, 11);
                    pdf.text('$' + totalCost.toLocaleString('en-US', { maximumFractionDigits: 0 }), M + bw + 3 + bw / 2, Y + 12, { align: 'center' });
                    
                    box(M + 2 * bw + 6, Y, bw, 16, [254, 242, 242], [252, 165, 165]);
                    pdf.setFontSize(6.5);
                    pdf.setFont('helvetica', 'normal');
                    pdf.setTextColor(100, 100, 100);
                    pdf.text('Fees Lost (' + timeHorizon + 'Y)', M + 2 * bw + 6 + bw / 2, Y + 4.5, { align: 'center' });
                    pdf.setFontSize(13);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(239, 68, 68);
                    pdf.text('$' + totalFeesLost.toLocaleString('en-US', { maximumFractionDigits: 0 }), M + 2 * bw + 6 + bw / 2, Y + 12, { align: 'center' });
                    
                    Y += 20;
                    
                    // === Growth (4 boxes) ===
                    pdf.setFontSize(12);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(0, 0, 0);
                    pdf.text('GROWTH PROJECTION', M, Y);
                    Y += 5;
                    
                    const gbw = (W - 2 * M - 9) / 4;
                    
                    box(M, Y, gbw, 16, [239, 246, 255], [147, 197, 253]);
                    pdf.setFontSize(6);
                    pdf.setTextColor(100, 100, 100);
                    pdf.text('Total Invested', M + gbw / 2, Y + 4.5, { align: 'center' });
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(30, 30, 30);
                    pdf.text('$' + totalContributed.toLocaleString('en-US', { maximumFractionDigits: 0 }), M + gbw / 2, Y + 11.5, { align: 'center' });
                    
                    box(M + gbw + 3, Y, gbw, 16, [236, 253, 245], [134, 239, 172]);
                    pdf.setFontSize(6);
                    pdf.setFont('helvetica', 'normal');
                    pdf.setTextColor(100, 100, 100);
                    pdf.text('Value (' + timeHorizon + 'Y)', M + gbw + 3 + gbw / 2, Y + 4.5, { align: 'center' });
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(16, 185, 129);
                    pdf.text('$' + finalValue.toLocaleString('en-US', { maximumFractionDigits: 0 }), M + gbw + 3 + gbw / 2, Y + 11.5, { align: 'center' });
                    
                    box(M + 2 * gbw + 6, Y, gbw, 16, [243, 232, 255], [196, 181, 253]);
                    pdf.setFontSize(6);
                    pdf.setFont('helvetica', 'normal');
                    pdf.setTextColor(100, 100, 100);
                    pdf.text('Growth', M + 2 * gbw + 6 + gbw / 2, Y + 4.5, { align: 'center' });
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(147, 51, 234);
                    pdf.text('$' + totalReturn.toLocaleString('en-US', { maximumFractionDigits: 0 }), M + 2 * gbw + 6 + gbw / 2, Y + 11.5, { align: 'center' });
                    
                    box(M + 3 * gbw + 9, Y, gbw, 16, [224, 231, 255], [165, 180, 252]);
                    pdf.setFontSize(6);
                    pdf.setFont('helvetica', 'normal');
                    pdf.setTextColor(100, 100, 100);
                    pdf.text('Return %', M + 3 * gbw + 9 + gbw / 2, Y + 4.5, { align: 'center' });
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(79, 70, 229);
                    pdf.text(totalContributed > 0 ? ((totalReturn / totalContributed) * 100).toFixed(1) + '%' : 'N/A', M + 3 * gbw + 9 + gbw / 2, Y + 11.5, { align: 'center' });
                    
                    Y += 20;
                    
                    // === Earnings (3 boxes) ===
                    pdf.setFontSize(12);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(0, 0, 0);
                    pdf.text('EARNINGS BREAKDOWN', M, Y);
                    Y += 5;
                    
                    box(M, Y, bw, 18, [240, 253, 250], [153, 246, 228]);
                    pdf.setFontSize(6.5);
                    pdf.setTextColor(100, 100, 100);
                    pdf.text('Dividend Income', M + bw / 2, Y + 4.5, { align: 'center' });
                    pdf.setFontSize(11);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(20, 184, 166);
                    pdf.text('$' + totalDividends.toLocaleString('en-US', { maximumFractionDigits: 0 }), M + bw / 2, Y + 11.5, { align: 'center' });
                    pdf.setFontSize(6);
                    pdf.setFont('helvetica', 'normal');
                    pdf.setTextColor(80, 80, 80);
                    pdf.text('Avg ' + growthData.weightedDividendYield.toFixed(2) + '% yield', M + bw / 2, Y + 15.5, { align: 'center' });
                    
                    box(M + bw + 3, Y, bw, 18, [254, 243, 199], [253, 230, 138]);
                    pdf.setFontSize(6.5);
                    pdf.setTextColor(100, 100, 100);
                    pdf.text('Capital Gains', M + bw + 3 + bw / 2, Y + 4.5, { align: 'center' });
                    pdf.setFontSize(11);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(217, 119, 6);
                    pdf.text('$' + capitalGains.toLocaleString('en-US', { maximumFractionDigits: 0 }), M + bw + 3 + bw / 2, Y + 11.5, { align: 'center' });
                    if (totalReturn > 0) {
                        pdf.setFontSize(6);
                        pdf.setFont('helvetica', 'normal');
                        pdf.setTextColor(80, 80, 80);
                        pdf.text(((capitalGains / totalReturn) * 100).toFixed(1) + '% of growth', M + bw + 3 + bw / 2, Y + 15.5, { align: 'center' });
                    }
                    
                    box(M + 2 * bw + 6, Y, bw, 18, [254, 242, 242], [254, 202, 202]);
                    pdf.setFontSize(6.5);
                    pdf.setTextColor(100, 100, 100);
                    pdf.text('Last Year Income', M + 2 * bw + 6 + bw / 2, Y + 4.5, { align: 'center' });
                    pdf.setFontSize(11);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(220, 38, 38);
                    pdf.text('$' + growthData.dividendIncome[growthData.dividendIncome.length - 1].toLocaleString('en-US', { maximumFractionDigits: 0 }), M + 2 * bw + 6 + bw / 2, Y + 11.5, { align: 'center' });
                    pdf.setFontSize(6);
                    pdf.setFont('helvetica', 'normal');
                    pdf.setTextColor(80, 80, 80);
                    pdf.text('Year ' + timeHorizon, M + 2 * bw + 6 + bw / 2, Y + 15.5, { align: 'center' });
                    
                    // === PAGE 2: Charts ===
                    pdf.addPage();
                    Y = M;
                    
                    // Growth chart - high resolution
                    if (growthChartRef.current) {
                        try {
                            await new Promise(r => setTimeout(r, 400));
                            const container = growthChartRef.current.parentElement;
                            const canvas = await html2canvas(container, {
                                scale: 4,
                                backgroundColor: '#ffffff',
                                logging: false,
                                useCORS: true
                            });
                            
                            if (canvas.width > 0) {
                                const imgData = canvas.toDataURL('image/png', 1.0);
                                pdf.setFontSize(12);
                                pdf.setFont('helvetica', 'bold');
                                pdf.setTextColor(0, 0, 0);
                                pdf.text('Growth Projection', M, Y);
                                Y += 6;
                                pdf.addImage(imgData, 'PNG', M, Y, W - 2 * M, 100);
                                Y += 105;
                            }
                        } catch (e) {
                            console.log('Chart error:', e);
                        }
                    }
                    
                    // Allocation chart - high resolution
                    if (chartRef.current && investmentAmount > 0) {
                        try {
                            await new Promise(r => setTimeout(r, 400));
                            const container = chartRef.current.parentElement;
                            const canvas = await html2canvas(container, {
                                scale: 4,
                                backgroundColor: '#ffffff',
                                logging: false,
                                useCORS: true
                            });
                            
                            if (canvas.width > 0) {
                                const imgData = canvas.toDataURL('image/png', 1.0);
                                pdf.setFontSize(12);
                                pdf.setFont('helvetica', 'bold');
                                pdf.setTextColor(0, 0, 0);
                                pdf.text('Portfolio Allocation', M, Y);
                                Y += 6;
                                pdf.addImage(imgData, 'PNG', M, Y, W - 2 * M, 80);
                                Y += 85;
                            }
                        } catch (e) {
                            console.log('Chart error:', e);
                        }
                    }
                    
                    // Disclaimer
                    if (Y > H - 70) {
                        pdf.addPage();
                        Y = M;
                    }
                    
                    box(M, Y, W - 2 * M, 45, [254, 252, 232], [250, 204, 21]);
                    pdf.setFontSize(10);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setTextColor(133, 77, 14);
                    pdf.text('IMPORTANT DISCLAIMER', M + 3, Y + 7);
                    
                    pdf.setFontSize(7.5);
                    pdf.setFont('helvetica', 'normal');
                    pdf.setTextColor(60, 60, 60);
                    const disc = 'This report is for educational purposes only. Projections are based on assumptions and past performance does not guarantee future results. Investment values can go down as well as up. Tax treatment depends on your individual situation and may change. The expense ratios, dividend yields, and tax efficiency ratings are estimates and may change. This is not financial advice. Consult a qualified financial advisor and tax professional.';
                    const lines = pdf.splitTextToSize(disc, W - 2 * M - 6);
                    pdf.text(lines, M + 3, Y + 14);
                    
                    pdf.setFontSize(7);
                    pdf.setTextColor(150, 150, 150);
                    pdf.text('Generated by Investment Allocation Calculator', W / 2, H - 8, { align: 'center' });
                    
                    pdf.save('investment-allocation-report.pdf');
                    
                } catch (error) {
                    console.error('PDF error:', error);
                    alert('Error generating PDF. Please try again.');
                } finally {
                    setIsGeneratingPDF(false);
                }
            };

            const sendEmailReport = () => {
                if (!userEmail || !userEmail.includes('@')) {
                    alert('Please enter a valid email address');
                    return;
                }
                
                // Create email body with summary
                const subject = 'My Investment Allocation Report';
                const body = `Investment Allocation Report
Generated: ${new Date().toLocaleDateString()}

PORTFOLIO SUMMARY:
- Mode: ${mode === 'guided' ? 'Guided Portfolio' : 'Custom Mix'}
- Initial Investment: $${investmentAmount.toLocaleString('en-US')}
${recurringContribution > 0 ? `- Recurring: $${recurringContribution.toLocaleString('en-US')} (${contributionFrequency})` : ''}
- Time Horizon: ${timeHorizon} years
- Expected Return: ${expectedReturn}%

FUND ALLOCATIONS:
${fundAllocations.map(fund => 
    `${fund.ticker} (${fund.provider}): $${fund.amount.toLocaleString('en-US', { minimumFractionDigits: 2 })} (${fund.percentage.toFixed(1)}%)
    Fee: ${fund.expenseRatio}% | Yield: ${fund.dividendYield}% | Tax: ${fund.taxEfficiency}`
).join('\n\n')}

COST ANALYSIS:
- Weighted Expense Ratio: ${weightedExpenseRatio.toFixed(3)}%
- Annual Cost: $${totalCost.toLocaleString('en-US', { minimumFractionDigits: 2 })}
- Fees Lost (${timeHorizon} years): $${totalFeesLost.toLocaleString('en-US', { minimumFractionDigits: 0 })}

GROWTH PROJECTION:
- Total Invested: $${totalContributed.toLocaleString('en-US', { minimumFractionDigits: 0 })}
- Projected Value: $${finalValue.toLocaleString('en-US', { minimumFractionDigits: 0 })}
- Investment Growth: $${totalReturn.toLocaleString('en-US', { minimumFractionDigits: 0 })}
${totalContributed > 0 ? `- Return: ${((totalReturn / totalContributed) * 100).toFixed(1)}%` : ''}

EARNINGS BREAKDOWN:
- Dividend Income: $${totalDividends.toLocaleString('en-US', { minimumFractionDigits: 0 })}
- Capital Gains: $${capitalGains.toLocaleString('en-US', { minimumFractionDigits: 0 })}
- Avg Yield: ${growthData.weightedDividendYield.toFixed(2)}%

---
This report is for educational purposes only. Past performance does not guarantee future results.
Consult a financial advisor for personalized advice.`;

                // Open email client with pre-filled data
                const mailtoLink = `mailto:${userEmail}?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
                window.location.href = mailtoLink;
            };

            const totalCustomAllocation = customFunds.reduce((sum, fund) => sum + fund.allocation, 0);

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-4 md:p-8">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 md:p-8 mb-6">
                            <div className="flex items-center gap-3 mb-2">
                                <TrendingUp className="w-8 h-8 text-blue-600" />
                                <h1 className="text-2xl md:text-3xl font-bold text-gray-800">Investment Allocation Calculator</h1>
                            </div>
                            <p className="text-gray-600 mb-6">Low-cost index fund portfolio builder with growth projections</p>

                            {/* Mode Selector */}
                            <div className="flex gap-4 mb-6">
                                <button
                                    onClick={() => setMode('guided')}
                                    className={`flex-1 p-4 rounded-lg border-2 transition-all ${
                                        mode === 'guided'
                                            ? 'border-blue-500 bg-blue-50'
                                            : 'border-gray-300 hover:border-gray-400'
                                    }`}
                                >
                                    <div className="flex items-center justify-center gap-2 mb-2">
                                        <Sparkles className="w-5 h-5" />
                                        <span className="font-semibold">Guided Portfolios</span>
                                    </div>
                                    <p className="text-sm text-gray-600">Choose from pre-built strategies</p>
                                </button>
                                <button
                                    onClick={() => setMode('custom')}
                                    className={`flex-1 p-4 rounded-lg border-2 transition-all ${
                                        mode === 'custom'
                                            ? 'border-blue-500 bg-blue-50'
                                            : 'border-gray-300 hover:border-gray-400'
                                    }`}
                                >
                                    <div className="flex items-center justify-center gap-2 mb-2">
                                        <Sliders className="w-5 h-5" />
                                        <span className="font-semibold">Custom Mix</span>
                                    </div>
                                    <p className="text-sm text-gray-600">Build your own allocation</p>
                                </button>
                            </div>

                            {/* Investment Amount Input */}
                            <div className="mb-6">
                                <label className="block text-sm font-semibold text-gray-700 mb-2">
                                    <DollarSign className="inline w-4 h-4 mr-1" />
                                    Initial Investment (Optional - can be $0)
                                </label>
                                <input
                                    type="number"
                                    value={investmentAmount}
                                    onChange={(e) => setInvestmentAmount(Math.max(0, Number(e.target.value)))}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg text-lg font-semibold focus:border-blue-500 focus:outline-none"
                                    min="0"
                                    step="1000"
                                />
                            </div>

                            {mode === 'guided' ? (
                                <>
                                    {/* Portfolio Selection */}
                                    <div className="mb-6">
                                        <label className="block text-sm font-semibold text-gray-700 mb-3">
                                            Portfolio Strategy
                                        </label>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {guidedPortfolios.map((portfolio, index) => (
                                                <button
                                                    key={index}
                                                    onClick={() => setSelectedPortfolio(index)}
                                                    className={`p-4 rounded-lg border-2 transition-all text-left relative ${
                                                        selectedPortfolio === index
                                                            ? 'border-blue-500 bg-blue-50'
                                                            : 'border-gray-300 hover:border-gray-400'
                                                    }`}
                                                >
                                                    {index === lowestIndex && (
                                                        <div className="absolute -top-2 -right-2 bg-green-500 text-white text-xs font-bold px-2 py-1 rounded-full">
                                                            LOWEST FEES
                                                        </div>
                                                    )}
                                                    <div className="flex justify-between items-start mb-1">
                                                        <div className="font-semibold text-gray-800">{portfolio.name}</div>
                                                        <span className="text-xs bg-gray-200 px-2 py-1 rounded">{portfolio.complexity}</span>
                                                    </div>
                                                    <div className="text-sm text-gray-600 mb-2">{portfolio.description}</div>
                                                    <div className="text-xs text-gray-500">
                                                        {portfolio.funds.map(f => f.ticker).join(' + ')}
                                                    </div>
                                                </button>
                                            ))}
                                        </div>
                                    </div>

                                    {/* Allocation Slider */}
                                    <div className="mb-6">
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                                            <Percent className="inline w-4 h-4 mr-1" />
                                            US / International Split
                                        </label>
                                        <div className="flex items-center gap-4">
                                            <span className="text-sm font-medium text-blue-600 w-16">{usAllocation}% US</span>
                                            <input
                                                type="range"
                                                min="0"
                                                max="100"
                                                value={usAllocation}
                                                onChange={(e) => setUsAllocation(Number(e.target.value))}
                                                className="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer"
                                            />
                                            <span className="text-sm font-medium text-green-600 w-24">{internationalAllocation}% Intl</span>
                                        </div>
                                    </div>
                                </>
                            ) : (
                                <>
                                    {/* Custom Fund Selection */}
                                    <div className="mb-6">
                                        <label className="block text-sm font-semibold text-gray-700 mb-3">
                                            Build Your Portfolio
                                        </label>
                                        <div className="mb-3 p-3 bg-blue-50 rounded-lg border border-blue-200">
                                            <p className="text-sm text-blue-800">
                                                <span className="font-semibold">📚 20+ Low-Cost ETFs Available:</span> Choose from Vanguard, Schwab, iShares (BlackRock), and SPDR funds. All have expense ratios under 0.11% and excellent tax efficiency.
                                            </p>
                                        </div>
                                        <div className="space-y-3">
                                            {customFunds.map((fund, index) => {
                                                const selectedEtf = etfs[fund.ticker.toLowerCase()];
                                                return (
                                                    <div key={index} className="border-2 border-gray-200 rounded-lg p-3">
                                                        <div className="flex gap-3 items-start mb-2">
                                                            <select
                                                                value={fund.ticker}
                                                                onChange={(e) => updateCustomFund(index, 'ticker', e.target.value)}
                                                                className="flex-1 px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm"
                                                            >
                                                                <optgroup label="Vanguard ETFs">
                                                                    {Object.keys(etfs).filter(key => etfs[key].provider === 'Vanguard').map(key => (
                                                                        <option key={key} value={key.toUpperCase()}>
                                                                            {key.toUpperCase()} - {etfs[key].fullName} ({etfs[key].expenseRatio}%)
                                                                        </option>
                                                                    ))}
                                                                </optgroup>
                                                                <optgroup label="Schwab ETFs">
                                                                    {Object.keys(etfs).filter(key => etfs[key].provider === 'Schwab').map(key => (
                                                                        <option key={key} value={key.toUpperCase()}>
                                                                            {key.toUpperCase()} - {etfs[key].fullName} ({etfs[key].expenseRatio}%)
                                                                        </option>
                                                                    ))}
                                                                </optgroup>
                                                                <optgroup label="iShares ETFs (BlackRock)">
                                                                    {Object.keys(etfs).filter(key => etfs[key].provider === 'iShares').map(key => (
                                                                        <option key={key} value={key.toUpperCase()}>
                                                                            {key.toUpperCase()} - {etfs[key].fullName} ({etfs[key].expenseRatio}%)
                                                                        </option>
                                                                    ))}
                                                                </optgroup>
                                                                <optgroup label="SPDR ETFs (State Street)">
                                                                    {Object.keys(etfs).filter(key => etfs[key].provider === 'SPDR').map(key => (
                                                                        <option key={key} value={key.toUpperCase()}>
                                                                            {key.toUpperCase()} - {etfs[key].fullName} ({etfs[key].expenseRatio}%)
                                                                        </option>
                                                                    ))}
                                                                </optgroup>
                                                            </select>
                                                            <input
                                                                type="number"
                                                                value={fund.allocation}
                                                                onChange={(e) => updateCustomFund(index, 'allocation', Math.max(0, Math.min(100, Number(e.target.value))))}
                                                                className="w-24 px-3 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none text-sm"
                                                                min="0"
                                                                max="100"
                                                            />
                                                            <span className="text-sm font-medium mt-2">%</span>
                                                            {customFunds.length > 1 && (
                                                                <button
                                                                    onClick={() => removeCustomFund(index)}
                                                                    className="px-3 py-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 transition-colors text-sm"
                                                                >
                                                                    Remove
                                                                </button>
                                                            )}
                                                        </div>
                                                        {selectedEtf && (
                                                            <div className="text-xs text-gray-600 grid grid-cols-2 md:grid-cols-4 gap-2 bg-gray-50 p-2 rounded">
                                                                <div>
                                                                    <span className="font-semibold">Fee:</span> {selectedEtf.expenseRatio}%
                                                                </div>
                                                                <div>
                                                                    <span className="font-semibold">Yield:</span> {selectedEtf.dividendYield}%
                                                                </div>
                                                                <div>
                                                                    <span className="font-semibold">Tax:</span> {selectedEtf.taxEfficiency}
                                                                </div>
                                                                <div>
                                                                    <span className="font-semibold">Turnover:</span> {selectedEtf.turnover}%
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                );
                                            })}
                                        </div>
                                        <div className="flex gap-3 mt-3">
                                            <button
                                                onClick={addCustomFund}
                                                disabled={customFunds.length >= Object.keys(etfs).length}
                                                className="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
                                            >
                                                Add Fund
                                            </button>
                                            {totalCustomAllocation !== 100 && (
                                                <button
                                                    onClick={normalizeAllocations}
                                                    className="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors"
                                                >
                                                    Split Evenly (100%)
                                                </button>
                                            )}
                                        </div>
                                        {totalCustomAllocation !== 100 && (
                                            <p className="text-sm text-orange-600 mt-2">
                                                Total: {totalCustomAllocation}% (should equal 100%)
                                            </p>
                                        )}
                                    </div>
                                </>
                            )}

                            {/* Growth Assumptions */}
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        Expected Annual Return (%)
                                    </label>
                                    <input
                                        type="number"
                                        value={expectedReturn}
                                        onChange={(e) => setExpectedReturn(Math.max(0, Math.min(20, Number(e.target.value))))}
                                        className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                        min="0"
                                        max="20"
                                        step="0.5"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-semibold text-gray-700 mb-2">
                                        Time Horizon (Years)
                                    </label>
                                    <input
                                        type="number"
                                        value={timeHorizon}
                                        onChange={(e) => setTimeHorizon(Math.max(1, Math.min(40, Number(e.target.value))))}
                                        className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                        min="1"
                                        max="40"
                                    />
                                </div>
                            </div>

                            {/* Dollar-Cost Averaging Section */}
                            <div className="border-t-2 border-gray-200 pt-6">
                                <h3 className="text-lg font-semibold text-gray-800 mb-4">💰 Dollar-Cost Averaging</h3>
                                <p className="text-sm text-gray-600 mb-4">Add regular contributions (daily, weekly, monthly, etc.) to see how consistently investing over time accelerates growth</p>
                                
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                                            Recurring Contribution Amount ($)
                                        </label>
                                        <input
                                            type="number"
                                            value={recurringContribution}
                                            onChange={(e) => setRecurringContribution(Math.max(0, Number(e.target.value)))}
                                            className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                            min="0"
                                            step="100"
                                            placeholder="0"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-sm font-semibold text-gray-700 mb-2">
                                            Contribution Frequency
                                        </label>
                                        <select
                                            value={contributionFrequency}
                                            onChange={(e) => setContributionFrequency(e.target.value)}
                                            className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-blue-500 focus:outline-none"
                                        >
                                            <option value="daily">Business Daily (Mon-Fri)</option>
                                            <option value="weekly">Weekly</option>
                                            <option value="monthly">Monthly</option>
                                            <option value="quarterly">Quarterly</option>
                                            <option value="annually">Annually</option>
                                        </select>
                                    </div>
                                </div>

                                {recurringContribution > 0 && (
                                    <div className="mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200">
                                        <p className="text-sm text-blue-800">
                                            <span className="font-semibold">Total contributions over {timeHorizon} years:</span> ${totalContributed.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                                            {investmentAmount > 0 
                                                ? ` ($${investmentAmount.toLocaleString('en-US')} initial + $${(totalContributed - investmentAmount).toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })} in recurring contributions)`
                                                : ` (All from ${contributionFrequency} contributions)`
                                            }
                                        </p>
                                    </div>
                                )}

                                {investmentAmount === 0 && recurringContribution === 0 && (
                                    <div className="mt-3 p-3 bg-orange-50 rounded-lg border border-orange-200">
                                        <p className="text-sm text-orange-800">
                                            <span className="font-semibold">💡 Tip:</span> Set an initial investment amount or add recurring contributions to see your portfolio grow!
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Results Grid */}
                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                            {/* Allocation Breakdown */}
                            <div className="bg-white rounded-2xl shadow-xl p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">Your Portfolio</h2>
                                
                                {investmentAmount > 0 ? (
                                    <>
                                        <div className="h-64 mb-6 flex items-center justify-center">
                                            <canvas ref={chartRef} style={{maxHeight: '250px'}}></canvas>
                                        </div>

                                        <div className="space-y-4">
                                            {fundAllocations.map((fund, index) => {
                                                const borderColors = ['border-blue-500', 'border-indigo-500', 'border-green-500', 'border-emerald-500', 'border-yellow-500', 'border-red-500'];
                                                const bgColors = ['bg-blue-50', 'bg-indigo-50', 'bg-green-50', 'bg-emerald-50', 'bg-yellow-50', 'bg-red-50'];
                                                
                                                return (
                                                    <div key={index} className={`border-l-4 ${borderColors[index]} pl-4 py-2 ${bgColors[index]} rounded-r`}>
                                                        <div className="flex justify-between items-start mb-1">
                                                            <div className="text-sm text-gray-600 font-medium">{fund.ticker} - {fund.fullName}</div>
                                                            <span className="text-xs bg-white px-2 py-1 rounded font-semibold text-gray-700">{fund.provider}</span>
                                                        </div>
                                                        <div className="text-2xl font-bold text-gray-800">
                                                            ${fund.amount.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                                                        </div>
                                                        <div className="text-xs text-gray-500 mt-2 grid grid-cols-2 gap-x-3">
                                                            <div><span className="font-semibold">Allocation:</span> {fund.percentage.toFixed(1)}%</div>
                                                            <div><span className="font-semibold">Fee:</span> {fund.expenseRatio}%</div>
                                                            <div><span className="font-semibold">Yield:</span> {fund.dividendYield}%</div>
                                                            <div><span className="font-semibold">Tax:</span> {fund.taxEfficiency}</div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </>
                                ) : (
                                    <div className="h-64 mb-6 flex items-center justify-center">
                                        <div className="text-center p-8 bg-gray-50 rounded-lg">
                                            <p className="text-gray-600 mb-2">No initial investment</p>
                                            <p className="text-sm text-gray-500">Your portfolio will build through recurring contributions</p>
                                        </div>
                                    </div>
                                )}
                            </div>

                            {/* Cost Analysis */}
                            <div className="bg-white rounded-2xl shadow-xl p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">Cost Analysis</h2>
                                
                                <div className="space-y-6">
                                    <div className="bg-gradient-to-br from-blue-50 to-blue-100 p-6 rounded-xl">
                                        <div className="text-sm text-gray-600 mb-1">Weighted Expense Ratio</div>
                                        <div className="text-4xl font-bold text-blue-600">
                                            {weightedExpenseRatio.toFixed(3)}%
                                        </div>
                                        <div className="text-xs text-gray-500 mt-2">Blended annual cost</div>
                                    </div>

                                    <div>
                                        <div className="flex justify-between items-center mb-3">
                                            <span className="text-sm font-semibold text-gray-700">Annual Costs Breakdown</span>
                                        </div>
                                        
                                        <div className="space-y-3">
                                            {fundAllocations.map((fund, index) => (
                                                <div key={index} className="flex justify-between items-center p-3 bg-gray-50 rounded-lg">
                                                    <span className="text-sm text-gray-600">{fund.ticker} annual fee</span>
                                                    <span className="font-semibold text-gray-800">
                                                        ${fund.cost.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                                                    </span>
                                                </div>
                                            ))}
                                            
                                            <div className="flex justify-between items-center p-3 bg-blue-100 rounded-lg border-2 border-blue-300">
                                                <span className="text-sm font-bold text-gray-800">Total Annual Cost</span>
                                                <span className="text-lg font-bold text-blue-600">
                                                    ${totalCost.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 })}
                                                </span>
                                            </div>
                                        </div>
                                    </div>

                                    <div className="bg-orange-50 p-4 rounded-lg border border-orange-200">
                                        <div className="flex items-start gap-2">
                                            <Info className="w-5 h-5 text-orange-600 mt-0.5 flex-shrink-0" />
                                            <div>
                                                <div className="text-sm font-semibold text-orange-900 mb-1">Lost to Fees Over {timeHorizon} Years</div>
                                                <div className="text-2xl font-bold text-orange-600">
                                                    ${totalFeesLost.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                                                </div>
                                                <div className="text-xs text-orange-700 mt-1">
                                                    Growth you're giving up to expenses
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Growth Projection */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">Growth Projection</h2>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                                <div className="bg-blue-50 p-4 rounded-lg">
                                    <div className="text-sm text-gray-600 mb-1">Total Invested</div>
                                    <div className="text-2xl font-bold text-gray-800">
                                        ${totalContributed.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                                    </div>
                                    <div className="text-xs text-gray-500 mt-1">
                                        Your contributions
                                    </div>
                                </div>
                                <div className="bg-green-50 p-4 rounded-lg">
                                    <div className="text-sm text-gray-600 mb-1">Projected Value ({timeHorizon} years)</div>
                                    <div className="text-2xl font-bold text-green-600">
                                        ${finalValue.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                                    </div>
                                    <div className="text-xs text-gray-500 mt-1">
                                        Total portfolio value
                                    </div>
                                </div>
                                <div className="bg-purple-50 p-4 rounded-lg">
                                    <div className="text-sm text-gray-600 mb-1">Investment Growth</div>
                                    <div className="text-2xl font-bold text-purple-600">
                                        ${totalReturn.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                                    </div>
                                    <div className="text-xs text-gray-500 mt-1">
                                        {totalContributed > 0 ? `${((totalReturn / totalContributed) * 100).toFixed(1)}% return` : 'N/A'}
                                    </div>
                                </div>
                                <div className="bg-indigo-50 p-4 rounded-lg">
                                    <div className="text-sm text-gray-600 mb-1">Growth vs Contributions</div>
                                    <div className="text-2xl font-bold text-indigo-600">
                                        {finalValue > 0 ? `${((totalReturn / finalValue) * 100).toFixed(1)}%` : '0%'}
                                    </div>
                                    <div className="text-xs text-gray-500 mt-1">
                                        From market growth
                                    </div>
                                </div>
                            </div>

                            {/* Earnings Breakdown */}
                            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                                <div className="bg-teal-50 p-4 rounded-lg border-2 border-teal-200">
                                    <div className="text-sm text-gray-600 mb-1">💰 Estimated Dividend Income</div>
                                    <div className="text-2xl font-bold text-teal-600">
                                        ${totalDividends.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                                    </div>
                                    <div className="text-xs text-gray-500 mt-1">
                                        Avg yield: {growthData.weightedDividendYield.toFixed(2)}% • Qualified dividends
                                    </div>
                                </div>
                                <div className="bg-amber-50 p-4 rounded-lg border-2 border-amber-200">
                                    <div className="text-sm text-gray-600 mb-1">📈 Estimated Capital Gains</div>
                                    <div className="text-2xl font-bold text-amber-600">
                                        ${capitalGains.toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                                    </div>
                                    <div className="text-xs text-gray-500 mt-1">
                                        {totalReturn > 0 ? `${((capitalGains / totalReturn) * 100).toFixed(1)}% of growth` : 'N/A'} • Long-term rate eligible
                                    </div>
                                </div>
                                <div className="bg-rose-50 p-4 rounded-lg border-2 border-rose-200">
                                    <div className="text-sm text-gray-600 mb-1">💸 Last Year Dividend Income</div>
                                    <div className="text-2xl font-bold text-rose-600">
                                        ${growthData.dividendIncome[growthData.dividendIncome.length - 1].toLocaleString('en-US', { minimumFractionDigits: 0, maximumFractionDigits: 0 })}
                                    </div>
                                    <div className="text-xs text-gray-500 mt-1">
                                        Annual income in year {timeHorizon}
                                    </div>
                                </div>
                            </div>

                            <div className="h-80">
                                <canvas ref={growthChartRef}></canvas>
                            </div>

                            <p className="text-xs text-gray-500 mt-4">
                                * Assumes {expectedReturn}% annual return before fees{recurringContribution > 0 ? `, with ${contributionFrequency} contributions of $${recurringContribution.toLocaleString('en-US')}` : ', no additional contributions'}. 
                                Dividend estimates based on current yields ({growthData.weightedDividendYield.toFixed(2)}% avg). Past performance does not guarantee future results.
                            </p>
                        </div>

                        {/* Export Report Section */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">📧 Export Your Report</h2>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                {/* Download PDF */}
                                <div className="border-2 border-blue-200 rounded-lg p-6 bg-blue-50">
                                    <h3 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                        <Download className="w-5 h-5 text-blue-600" />
                                        Download PDF Report
                                    </h3>
                                    <p className="text-sm text-gray-600 mb-4">
                                        Generate a comprehensive PDF with your portfolio allocations, cost analysis, and growth projections.
                                    </p>
                                    <button
                                        onClick={generatePDF}
                                        disabled={isGeneratingPDF}
                                        className="w-full px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-semibold disabled:bg-gray-400 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                                    >
                                        <Download className="w-5 h-5" />
                                        {isGeneratingPDF ? 'Generating PDF...' : 'Download PDF Report'}
                                    </button>
                                </div>

                                {/* Email Report */}
                                <div className="border-2 border-green-200 rounded-lg p-6 bg-green-50">
                                    <h3 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                        <Mail className="w-5 h-5 text-green-600" />
                                        Email Report to Yourself
                                    </h3>
                                    <p className="text-sm text-gray-600 mb-4">
                                        Send a detailed text summary to your email. Your email client will open with the report pre-filled.
                                    </p>
                                    <input
                                        type="email"
                                        placeholder="your.email@example.com"
                                        value={userEmail}
                                        onChange={(e) => setUserEmail(e.target.value)}
                                        className="w-full px-4 py-2 border-2 border-gray-300 rounded-lg focus:border-green-500 focus:outline-none mb-3 text-sm"
                                    />
                                    <button
                                        onClick={sendEmailReport}
                                        className="w-full px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors font-semibold flex items-center justify-center gap-2"
                                    >
                                        <Mail className="w-5 h-5" />
                                        Open Email Client
                                    </button>
                                </div>
                            </div>

                            <p className="text-xs text-gray-500 mt-4 text-center">
                                💡 Tip: Save these reports for your records or share with your financial advisor
                            </p>
                        </div>

                        {/* Why This Portfolio */}
                        <div className="bg-white rounded-2xl shadow-xl p-6 mb-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">Why Low-Cost Index Funds?</h2>
                            
                            <div className="grid grid-cols-1 md:grid-cols-4 gap-6">
                                <div className="bg-blue-50 p-4 rounded-lg">
                                    <h3 className="font-semibold text-gray-800 mb-2">✓ Ultra-Low Costs</h3>
                                    <p className="text-sm text-gray-600">
                                        These ETFs have expense ratios of 0.03-0.11%. Over decades, low fees compound into massive savings.
                                    </p>
                                </div>

                                <div className="bg-green-50 p-4 rounded-lg">
                                    <h3 className="font-semibold text-gray-800 mb-2">✓ Tax Efficient</h3>
                                    <p className="text-sm text-gray-600">
                                        ETFs create fewer taxable events than mutual funds. Low turnover means qualified dividend treatment.
                                    </p>
                                </div>

                                <div className="bg-purple-50 p-4 rounded-lg">
                                    <h3 className="font-semibold text-gray-800 mb-2">✓ Instant Diversification</h3>
                                    <p className="text-sm text-gray-600">
                                        2-3 funds give you exposure to thousands of companies globally. Simple, effective, proven.
                                    </p>
                                </div>

                                <div className="bg-orange-50 p-4 rounded-lg">
                                    <h3 className="font-semibold text-gray-800 mb-2">✓ Set & Forget</h3>
                                    <p className="text-sm text-gray-600">
                                        No need to pick stocks or time the market. Index investing beats most active managers long-term.
                                    </p>
                                </div>
                            </div>
                        </div>

                        {/* Tax Efficiency & Fees Explained */}
                        <div className="bg-white rounded-2xl shadow-xl p-6">
                            <h2 className="text-xl font-bold text-gray-800 mb-4">📊 Understanding Fees & Tax Efficiency</h2>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                <div className="border-2 border-blue-200 rounded-lg p-4 bg-blue-50">
                                    <h3 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                        💵 Expense Ratios
                                    </h3>
                                    <div className="space-y-2 text-sm text-gray-700">
                                        <p><span className="font-semibold">0.03%:</span> Exceptional (Vanguard, Schwab, iShares core funds)</p>
                                        <p><span className="font-semibold">0.04-0.06%:</span> Excellent (Most low-cost index ETFs)</p>
                                        <p><span className="font-semibold">0.07-0.11%:</span> Very good (International/emerging market funds)</p>
                                        <p className="text-xs text-gray-600 mt-2 pt-2 border-t border-blue-300">
                                            Example: On $10,000, a 0.03% fee costs $3/year vs. 1% = $100/year. Over 30 years with growth, that difference becomes ~$25,000!
                                        </p>
                                    </div>
                                </div>

                                <div className="border-2 border-green-200 rounded-lg p-4 bg-green-50">
                                    <h3 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                        🏛️ Tax Efficiency Ratings
                                    </h3>
                                    <div className="space-y-2 text-sm text-gray-700">
                                        <p><span className="font-semibold">Excellent:</span> Low turnover (3-5%), minimal capital gains distributions</p>
                                        <p><span className="font-semibold">Very Good:</span> Moderate turnover (4-15%), occasional distributions</p>
                                        <p><span className="font-semibold">Good:</span> Higher turnover (8-15%), more frequent distributions</p>
                                        <p className="text-xs text-gray-600 mt-2 pt-2 border-t border-green-300">
                                            All these ETFs qualify for: (1) Qualified dividend tax rates (max 20% vs. ordinary income), (2) Long-term capital gains rates if held 1+ year
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div className="border-2 border-purple-200 rounded-lg p-4 bg-purple-50">
                                    <h3 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                        🔄 Turnover Rate
                                    </h3>
                                    <p className="text-sm text-gray-700 mb-2">
                                        Percentage of holdings replaced annually. Lower is better for taxes.
                                    </p>
                                    <div className="space-y-1 text-sm text-gray-700">
                                        <p><span className="font-semibold">3-5%:</span> Very low (S&P 500, Total Market)</p>
                                        <p><span className="font-semibold">5-10%:</span> Low (International broad market)</p>
                                        <p><span className="font-semibold">10-15%:</span> Moderate (Small-cap, emerging markets)</p>
                                    </div>
                                </div>

                                <div className="border-2 border-teal-200 rounded-lg p-4 bg-teal-50">
                                    <h3 className="font-semibold text-gray-800 mb-3 flex items-center gap-2">
                                        💰 Dividend Yields
                                    </h3>
                                    <p className="text-sm text-gray-700 mb-2">
                                        Annual dividend income as % of investment. Paid quarterly.
                                    </p>
                                    <div className="space-y-1 text-sm text-gray-700">
                                        <p><span className="font-semibold">1.3-1.5%:</span> US stocks (growth-focused)</p>
                                        <p><span className="font-semibold">3.0-3.3%:</span> International developed (value-focused)</p>
                                        <p><span className="font-semibold">3.4-3.7%:</span> Emerging markets (higher yield)</p>
                                    </div>
                                </div>
                            </div>

                            <div className="mt-6 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <div className="flex items-start gap-2">
                                    <Info className="w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0" />
                                    <div className="text-sm text-gray-700">
                                        <span className="font-semibold">Tax Tip:</span> In taxable accounts, these low-turnover ETFs minimize taxable events. 
                                        You only pay capital gains tax when YOU sell (not when the fund rebalances). Dividends are taxed annually but qualify for lower rates. 
                                        For tax-advantaged accounts (IRA, 401k), tax efficiency matters less since growth is tax-deferred.
                                    </div>
                                </div>
                            </div>

                            <div className="mt-4 bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                                <div className="flex items-start gap-2">
                                    <Info className="w-5 h-5 text-yellow-600 mt-0.5 flex-shrink-0" />
                                    <div className="text-sm text-gray-700">
                                        <span className="font-semibold">Disclaimer:</span> This calculator is for educational purposes only. 
                                        Projections are based on assumptions and past performance doesn't guarantee future results. 
                                        Tax treatment depends on your individual situation. Consider consulting a financial advisor and tax professional for personalized advice.
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<InvestmentCalculator />);
    </script>
</body>
</html>